@using Webdiyer.WebControls.Mvc;
@using MoneyRetard.Common
@{
    Layout = null;
}

@model PagedList<MoneyRetard.Models.Manage_UserDetail>
<!DOCTYPE html>

<html>
<head>
    <title>ManageAccount</title>
    <link href="../../js/jquery-ui/jquery-ui.css" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/jquery-1.9.0.js" type="text/javascript"></script>
    <script src="../../js/jquery-ui/jquery-ui.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            $("#btn").click(Search);
            $("#txt").val('@ViewData["kw"]');
            $("#usertype").val('@ViewData["usertype"]');
            $("#type").val('@ViewData["type"]');
            $("#start").val('@ViewData["start"]');
            $("#area").val('@ViewData["area"]');
            $("#UserInfo").dialog({
                autoOpen: false,
                height: 300,
                width: 350,
                modal: true,
                title: "用户信息审核/修改",
                buttons: {
                    "提交": function () {
                        if ($("#uname").val() == '') {
                            alert('用户名不能为空');
                            return false;
                        }
                        if ($("#upwd").val() == '') {
                            alert('密码不能为空');
                            return false;
                        }
                        if ($("#ucompanyname").val() == '') {
                            alert('企业名称不能为空');
                            return false;
                        }
                        if ($("#ucallnum").val() == '') {
                            alert('联系号码不能为空');
                            return false;
                        }
                        if ($("#ucallnum").val() != '') {
                            var reg2 = /^((0\d{2,3}-\d{7,8})|(0\d{2,3}\d{7,8})|(\d{7,8})|(1[3584]\d{9}))$/;
                            if (reg2.test($("#ucallnum").val()) == false) {
                                alert("联系号不合法,请重填");
                                $("#ucallnum").val("");
                                return false;
                            }
                        }
                        if ($("#uadd").val() == '') {
                            alert('企业地址不能为空');
                            return false;
                        }
                        if ($("#uemail").val() != '') {
                            var reg = /\w+([-+.]\w+)*@@\w+([-.]\w+)*\.\w+([-.]\w+)*/;
                            if (reg.test($("#uemail").val()) == false) {
                                alert("email地址不合法,请重填");
                                $("#uemail").val('');
                                return false;
                            }
                        }
                        if ($("#uqq").val() != '') {
                            var reg3 = /[1-9][0-9]{4,}/;
                            if (reg3.test($("#uqq").val()) == false) {
                                alert("qq号不合法,请重填");
                                $("#uqq").val("");
                                return false;
                            }
                        }
                        var data = $("#f1").serialize();
                        $.post("/Root/DoModify", data, function (jsobj) {
                            alert(jsobj.msg);
                            window.location.reload();
                        }, "json");
                    },
                    "取消": function () {
                        $(this).dialog('close');
                    }
                }
            });
        });
        function Search() {
            window.location = "/Root/Manageaccount?kw=" + $("#txt").val() + "&usertype=" + $("#usertype").val() + "&type=" + $("#type").val() + "&start=" + $("#start").val() + "&area=" + $("#area").val();
        };
        function ShowModify(id){
            $("#UserInfo").dialog("open");
            $.getJSON("/Root/GetUserInfo/" + id, null, function (jsobj) {
                $("#uid").val(jsobj.id);
                $("#uname").val(jsobj.UserName);
                $("#upwd").val(jsobj.Pwd);
                $("#ucompanyname").val(jsobj.UserRealName);
                $("#uisagency").val(jsobj.IsAgency);
                $("#uisstart").val(jsobj.IsStart);
                if (jsobj.IsAllocation == false) {
                    $("#uisallcation").val("0");
                }
                else {
                    $("#uisallcation").val("1");
                }
                $("#ulimits").val(jsobj.Limits);
                $("#utype").val(jsobj.UserType);
                $("#uarea").val(jsobj.Area);
                $("#ucallnum").val(jsobj.Phone);
                $("#uemail").val(jsobj.Email);
                $("#uqq").val(jsobj.QQ);
                $("#uadd").val(jsobj.Adress);
                $("#img1").attr("src","../../RegisterUpload/"+jsobj.Icard_1_Num);
                $("#img2").attr("src", "../../RegisterUpload/"+ jsobj.Icard_2_Num);
            });
        }
        function DoDel(id) {
            if (confirm("您确认删除此条账户信息?")) {
                $.post("/Root/DelUser/" + id, null, function (jsobj) {
                  alert(jsobj.msg);
                  window.location.reload();
                },"json");
            }
            else{
            return;
            }
        }
    </script>
</head>
<body>
    <div>
        账户管理<br />
        企业名
        <input type="text" id="txt" />
        用户类型 
        <select id="usertype">
        <option value="0">全部</option>
        <option value="6">企业</option>
        <option value="7">事业</option>
        <option value="8">高校</option>
        <option value="9">科研机构</option>
        <option value="10">机关团体</option>
        <option value="11">个人</option>
        </select>
        是否代理机构
        <select id="type">
        <option value="0">全部</option>
        <option value="1">非代理</option>
        <option value="2">代理</option>
        </select>
        是否开启
        <select id="start">
        <option value="2">全部</option>
        <option value="0">未启用</option>
        <option value="1">启用</option>
        </select>
        所属区域
        <select id="area">
        <option value="0">全部</option>
        <option value="8">花山区</option>
        <option value="9">雨山区</option>
        <option value="10">慈湖高新区</option>
        <option value="11">博望区</option>
        <option value="12">当涂县</option>
        <option value="13">含山县</option>
        <option value="14">和县</option>
        </select>
        <input type="button" id="btn"  value="搜索"/>
        <table>
        <tr>
        <td>用户ID</td><td>用户名</td><td>企业名</td><td>密码</td><td>是否可分配</td><td>是否开启</td><td>是否代理机构</td><td>权限</td><td>创建时间</td>
        <td>企业类型</td><td>区域</td> <td>企业地址</td><td>联系电话</td><td>qq</td><td>email</td><td>操作</td></tr>
        @foreach (MoneyRetard.Models.Manage_UserDetail item in Model) 
        {
            <tr>
            <td>@item.id</td>
            <td>@item.UserName</td>
              <td>@item.UserRealName</td>
            <td>@item.Pwd</td>
              <td>@PageHelper.IsAllocation(Convert.ToBoolean(item.IsAllocation))</td>
            <td>@PageHelper.IsStart(Convert.ToInt32(item.IsStart))</td>
              <td>@PageHelper.IsAgency(Convert.ToInt32(item.IsAgency))</td>
            <td>@PageHelper.Limits(Convert.ToInt32(item.Limits))</td>
              <td>@Convert.ToDateTime(item.CreateTime).ToString("yyyy-MM-dd")</td>
            <td>@PageHelper.UserType(Convert.ToInt32(item.UserType))</td>
              <td>@PageHelper.Area(Convert.ToInt32(item.Area))</td>
            <td>@item.Adress</td>
             <td>@item.Phone</td>
            <td>@item.QQ</td>
           <td>@item.Email</td>
           <td><a href="javascript:void(0)" onclick="ShowModify(@item.id)">审核/修改</a> <a href="javascript:void(0)" onclick="DoDel(@item.id)">删</a></td>
            </tr>
        }
        </table>
        @Html.Pager(Model, new PagerOptions { PageIndexParameterName = "id", ShowPageIndexBox = true, PageIndexBoxType = PageIndexBoxType.TextBox, ShowGoButton = true })
        @{Html.RegisterMvcPagerScriptResource();}

        <div id="UserInfo">
         <form id="f1">
         <input type="hidden" id="uid" name="uid"/>
         <span>用户名：</span><input type="text" id="uname" name="uname"/><br />
         <span>密码：</span><input type="text" id="upwd" name="upwd" /><br />
         <span>企业名：</span><input type="text" id="ucompanyname"  name="ucompanyname"/><br />
         <span>是否代理机构</span>
                            <select id="uisagency" name="uisagency">
                            <option value="1">非代理</option>
                            <option value="2">代理</option>
                            </select><br />
        <span>是否开启</span>
                            <select id="uisstart" name="uisstart">
                            <option value="0">未启用</option>
                            <option value="1">启用</option>
                            </select><br />
         <span>是否分配账号权利</span>
                            <select id="uisallcation" name="uisallcation">
                            <option value="0">不可分配</option>
                            <option value="1">可分配</option>
                            </select><br />
         <span>权限</span>
                            <select id="ulimits" name="ulimits">
                            <option value="0">超级管理员</option>
                            <option value="1">普通用户</option>
                            </select><br />
         <span>企业类型：</span><select name="utype" id="utype">
                            <option value="6">企业</option>
                            <option value="7">事业</option>
                            <option value="8">高校</option>
                            <option value="9">科研机构</option>
                            <option value="10">机关团体</option>
                            <option value="11">个人</option>
                            </select><br />
         <span>所属区县：</span><select id="uarea" name="uarea">
                                <option value="8">花山区</option>
                                <option value="9">雨山区</option>
                                <option value="10">慈湖高新区</option>
                                <option value="11">博望区</option>
                                <option value="12">当涂县</option>
                                <option value="13">含山县</option>
                                <option value="14">和县</option>
                                </select><br />
          <span>联系电话：</span><input type="text" id="ucallnum"  name="ucallnum"/><br />
          <span>E-mail：</span><input type="text"  id="uemail"  name="uemail"/><br />
         <span>QQ：</span><input type="text"  id="uqq" name="uqq" /><br />
          <span>企业地址：</span><input type="text"  id="uadd"  name="uadd"/><br />
         </form>
         证件照:
         <img  id="img1" style=" width:160; height:120;" />
         <img id="img2" style=" width:160; height:120;" />
        </div>
    </div>
</body>
</html>
